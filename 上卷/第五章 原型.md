# ç¬¬äº”ç«  åŸå‹

<!-- TOC -->

- [ç¬¬äº”ç«  åŸå‹](#ç¬¬äº”ç« -åŸå‹)
  - [[[Prototype]]](#prototype)
    - [è¯»å†™](#è¯»å†™)
    - [å­˜åœ¨æ€§](#å­˜åœ¨æ€§)
    - [[[GET]] ä¼˜å…ˆçº§](#get-ä¼˜å…ˆçº§)
    - [[[PUT]] è¯¦è§£](#put-è¯¦è§£)
    - [éšå¼å±è”½](#éšå¼å±è”½)
  - [ç±»](#ç±»)
    - [ç±»æ˜¯ä»€ä¹ˆ?](#ç±»æ˜¯ä»€ä¹ˆ)
    - [JavaScript çš„"ç±»"](#javascript-çš„ç±»)
    - [æ„é€ å‡½æ•°](#æ„é€ å‡½æ•°)
    - [åŸå½¢é™·é˜±](#åŸå½¢é™·é˜±)
  - [åŸå‹ç»§æ‰¿](#åŸå‹ç»§æ‰¿)

<!-- /TOC -->

## [[Prototype]]

> `JavaScript` ä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ `[[Prototype]]` å†…ç½®å±æ€§, ä½†è¿™ä¸ªå±æ€§ä»å“ªé‡Œæ¥çš„ï¼Ÿ

- æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡, å½“æˆ‘ä»¬ä½¿ç”¨å­—é¢é‡å£°æ˜å¯¹è±¡æ—¶, `JavaScript` å¼•æ“å®é™…ä¼šä»¥æ„é€ å½¢å¼æ¥è§£æå®ƒ:
`var obj = {} -> var obj = new Object()`

- ä¹Ÿå°±æ˜¯è¯´, æ¯ä¸€ä¸ªæ™®é€šå¯¹è±¡, éƒ½æ˜¯ç”± å†…ç½®æ„é€ å‡½æ•° `Object` åˆ›å»ºçš„,

- è‡ªç„¶, å¯¹è±¡å…·å¤‡ä¸€ä¸ª `constructor` å±æ€§, æŒ‡å‘å®ƒçš„æ„é€ å™¨:

``` javascript
var obj = {}

// console
> obj.constructor === Object
< true
```

- æ—¢ç„¶ `obj.constructor` æ‰€æŒ‡çš„æ˜¯æ„é€ å‡½æ•°, é‚£ä¹ˆæ„é€ å‡½æ•°ä¸‹å¿…å®šå…·æœ‰åŸå½¢å¯¹è±¡:

``` javascript
var obj = {}

// console
> obj.constructor.prototype === Object.prototype
< true
```

### è¯»å†™

- Object.**getPrototypeOf**(obj = `Object`) ES5, è¯¥æ–¹æ³•è¿”å›å¯¹è±¡çš„æ•´ä¸ªåŸå‹é“¾å¯¹è±¡

``` javascript
var str = 'str'

// console
> Object.getPrototypeOf(str)
< String: {
  toUpperCase: function toUpperCase(),
  concat: function concat(),
  charAt: function charAt(),
  ...
}
```

- Object.**setPrototypeOf**(obj = `Object`, prototype = `Object`) ES6, è¯¥æ–¹æ³•å°†ä¸ºæŒ‡å®šå¯¹è±¡è®¾ç½®åŸå‹é“¾, è¯¥æ–¹æ³•ä¼šè¦†ç›–åŒåå±æ€§, æ–°å¢å¯¹è±¡ä¹‹å‰ä¸å­˜åœ¨çš„å±æ€§, ä¿ç•™å¯¹è±¡ä¹‹å‰å­˜åœ¨çš„å±æ€§

``` javascript
var obj = {}
var prototype = { name: 'muzi' }
Object.setPrototypeOf(obj, prototype)
```

- Object.**create**(prototype = `Object`) ES5, è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°, è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡, æ–°å¯¹è±¡ä¼šå°†å‚æ•°ä¸­çš„å¯¹è±¡ä½œä¸ºè‡ªå·±çš„ åŸå‹é“¾

``` javascript
var prototype = { name: 'muzi' }
var obj = Object.create(prototype)

// console
> Object.getPrototypeOf(obj)
< {
	name: "muzi",
	__proto__: Object(),
}
```

> __proto__

å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª `__proto__`(ES6 ä¹‹å‰å¹¶ä¸æ˜¯æ ‡å‡†) ç¥ç§˜å±æ€§, å®ƒä¼¼ä¹ç›´æ¥æŒ‡å‘äº†å¯¹è±¡çš„åŸå‹é“¾, æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è¯¥å¯¹è±¡ä¸Šè¯»å–æˆ–è®¾ç½®åŸå‹å±æ€§:

``` javascript
var obj = {}

// console
> obj.__proto__ === Object.getPrototypeOf(obj)
< true
> obj.__proto__ === obj.constructor.prototype
< true
```

ä½†å®é™…ä¸Š `__proto__` å¹¶ä¸å­˜åœ¨äºä½ æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡ä¸­, å®ƒå’Œå…¶ä»–å¸¸ç”¨å‡½æ•°(.toString(), isPrototypeOf(), ç­‰) ä¸€æ ·, å­˜åœ¨äºå†…ç½®çš„ Object.prototype ä¸­, å¹¶ä¸”ä¸å¯æšä¸¾.

> __proto__ çš„å¤§è‡´å®ç°åŸç†å¦‚ä¸‹:

``` javascript
Object.defineProperty(Object.prototype, '__proto__', {
    get() {
        return Object.getPrototypeOf(this)
    },
    set(o) {
        Object.setPrototypeOf( this, o );
        return o
    }
})
```

### å­˜åœ¨æ€§

é€šå¸¸æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼åˆ¤æ–­:
- obj.**hasOwnProperty**(property = `String`) è¯¥æ–¹æ³•åªä¼šæŸ¥æ‰¾å¯¹è±¡çš„**è‡ªèº«å±æ€§**
- `key` in **obj** è¯¥æ–¹æ³•ä¸ `[[GET]]` ç±»ä¼¼, è‡ªèº«å±æ€§æ‰¾ä¸åˆ°å°±ä¼šåˆ° **åŸå‹é“¾** ä¸­æ‰¾, ç›´åˆ°æ‰¾åˆ°æˆ–æ‰¾å®Œæ•´æ¡åŸå‹é“¾ä¸ºæ­¢

ç”±æ­¤, æˆ‘ä»¬å¯ä»¥åˆ¤æ–­, `for...in` å¾ªç¯æ˜¯å¯ä»¥æšä¸¾å‡ºå¯¹è±¡åŸå‹é“¾ä¸­çš„å±æ€§çš„:

``` javascript
var prototype = {
    name: 'muzi',
    age: 25
}
Object.setPrototypeOf(prototype, { loc: 'cq' })

var person = {}
Object.setPrototypeOf(person, prototype)

for (var key in person) {
    console.log(key) // name age loc
}
```

### [[GET]] ä¼˜å…ˆçº§

æˆ‘ä»¬çŸ¥é“, å¦‚æœé‡åˆ° `obj.name` è¿™æ ·çš„è¯­å¥, `[[GET]]` æ“ä½œä¼šéå¸¸æ‰§ç€çš„å»å¯»æ‰¾ `name` å±æ€§,

ä½†å‡¡äº‹éƒ½æœ‰å…ˆåç§©åº, å¦‚æœä¸€ä¸ªå¯¹è±¡çš„è‡ªèº«å±æ€§å’ŒåŸå‹é“¾ä¸ŠåŒæ—¶å­˜åœ¨å‡ ä¸ª `name` å±æ€§, æˆ‘ä»¬å°±å¿…ç„¶éœ€è¦åˆ’åˆ†å–å€¼çš„å…ˆåç§©åº:

- å¯¹è±¡**è‡ªèº«å±æ€§**çš„ä¼˜å…ˆçº§æœ€é«˜, å¦‚ä¸‹æ‰€ç¤º, å¯¹è±¡è‡ªèº«çš„ `name` ä¼š *å±è”½* åŸå‹ä¸Šæ‰€æœ‰çš„ `name`:

``` javascript
var obj = {
  name: 'muzi'
}

obj.__proto__.name = 'yaya'

console.log(obj.name) // muzi
```

- å¯¹äº**åŸå‹é“¾**æ¥è¯´, åµŒå¥—çš„å±‚çº§è¶Šæµ…, ä¼˜å…ˆçº§è¶Šé«˜ *([[GET]] æŸ¥æ‰¾å½“ç„¶æ˜¯é€å±‚å‘ä¸‹æŸ¥æ‰¾, æ‰¾åˆ°å°±ç«‹å³è¿”å›)*, å¦‚ä¸‹æ‰€ç¤º, **çˆ¶çº§åŸå‹**ä¸­çš„ `name` å±è”½äº†**å­çº§åŸå‹**ä¸­çš„çš„ `name`

``` javascript
var prototype = {}
prototype.__proto__.name = 'yaya'

var obj = Object.create(prototype)

obj.age = 25
obj.__proto__.name = 'muzi'

// console
> obj
< {
  age: 25,
  __proto__: {
    name: "muzi",
    __proto__: {
      name: "yaya"
    }
  }
}

> obj.name
< "muzi"
```

æˆ‘ä»¬å°†è¿™ç§å±è”½äº†å…¶ä»–å±æ€§çš„å±æ€§, ç§°ä¹‹ä¸º **å±è”½å±æ€§**

### [[PUT]] è¯¦è§£

å¯¹è±¡é»˜è®¤çš„ `[[PUT]]` æ“ä½œä¼šåœ¨å±æ€§èµ‹å€¼çš„æƒ…å†µä¸‹è§¦å‘,

å®ƒçš„è¡Œä¸ºæ¯” `[[GET]]` æ“ä½œè¦å¤æ‚è®¸å¤š, æˆ‘ä»¬å…¨æ–¹ä½çš„æ¥è§£æä»¥ä¸‹è¯­å¥, ç†è§£ `[[PUT]]` çš„å·¥ä½œæ¨¡å¼:

``` javascript
obj.name = 'muzi'
```

> ä»¥ä¸‹ä¸‰å¤§è§„åˆ™, å°†åœ¨åç»­ä»¥ `1)` ç­‰åºå·çš„æ–¹å¼å¼•ç”¨:

- 1)å¦‚æœ `name` æ˜¯å¯¹è±¡çš„**è‡ªèº«å±æ€§**, è¯¥èµ‹å€¼è¯­å¥åªä¼šä¿®æ”¹å¯¹è±¡è‡ªèº«å·²æœ‰ `name`

- 2)å¦‚æœ `name` ä¸æ˜¯å¯¹è±¡çš„**è‡ªèº«å±æ€§**, ä¹Ÿä¸åœ¨**åŸå‹é“¾**ä¸­, `name` å°±ä¼šç›´æ¥æ·»åŠ åˆ°å¯¹è±¡çš„è‡ªèº«å±æ€§ä¸Š

- 3)å¦‚æœ `name` ä¸æ˜¯å¯¹è±¡çš„**è‡ªèº«å±æ€§**, è€Œåœ¨**åŸå‹é“¾**ä¸­, ä¼šå‡ºç°ä»¥ä¸‹ä¸‰ç§æƒ…å†µ:
  - 3.1)å¦‚æœ `name` å¯å†™ *(writable: true)*, ç›´æ¥åœ¨ä¸ºå¯¹è±¡åˆ›å»ºä¸€ä¸ªåŒåçš„**è‡ªèº«å±æ€§**, å¹¶èµ‹å€¼, è¿™æ˜¯ä¸€ä¸ª**å±è”½å±æ€§**, è¯¥å±æ€§**å±è”½**äº†åŸå‹é“¾ä¸Šæ‰€æœ‰åŒåå±æ€§

  - 3.2)å¦‚æœ `name` åªè¯» *(writable: false)*, è¯¥èµ‹å€¼è¯­å¥ä¼šè¢«å¿½ç•¥. å¦‚æœè¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹, ä¼šæŠ›å‡º `TypeError` çš„é”™è¯¯.

  - 3.3)å¦‚æœ `name` æ˜¯ä¸€ä¸ª `setter` ([å‚è§ç¬¬ä¸‰ç« ](https://github.com/muzqi/you-dont-know-js/blob/master/%E4%B8%8A%E5%8D%B7/%E7%AC%AC%E4%B8%89%E7%AB%A0%20%E5%AF%B9%E8%B1%A1.md#getter-setter)), é‚£å°±ä¸€å®šä¼šè°ƒç”¨è¿™ä¸ª `setter`, ä¸ä¼šåˆ›å»ºä¸€ä¸ª**å±è”½å±æ€§**, ä¹Ÿä¸ä¼šé‡æ–°å®šä¹‰ `name` çš„ `setter`.

äº‹å®ä¸Š, åœ¨ è§„åˆ™`3)` ä¸­, åªæœ‰ è§„åˆ™`3.1)` ä¼šåˆ›å»º **å±è”½å±æ€§**;

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨ è§„åˆ™`3.2)` å’Œ è§„åˆ™`3.3)` åˆ›å»ºå±è”½å±æ€§ `name`, æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `Object.defineProperty()`:

``` javascript
// è§„åˆ™ 3.2)
var prototype = {}
Object.defineProperty(prototype, 'name', {
    value: 'yaya',
    writable: false,  // åªè¯»
})

var obj = Object.create(prototype)

Object.defineProperty(obj, 'name', {
    value: 'muzi'
})

// console
> obj
< {
  name: "muzi",
  __proto__: {
    name: "yaya"
  }
}
```


``` javascript
// è§„åˆ™ 3.3)
var prototype = {}
Object.defineProperty(prototype, 'name', {
    get() {
      // è¿™é‡Œçš„ this å³æŒ‡å‘äº† obj å¯¹è±¡
      return this._name_ || 'yaya'
    },
    set(newVal) {
        this._name_ = newVal
    }
})

var obj = Object.create(prototype)

// console
> obj
< {
  name: "yaya",
  __proto__: {
    name: "yaya"
  }
}

> obj.name = "muzi"
< "muzi"

> obj
< {
  _name_: "muzi",
  name: "muzi",
  __proto__: {
    name: "muzi"
  }
}
```

### éšå¼å±è”½

> éšå¼å±è”½, å³éšå¼çš„åˆ›å»ºäº† **å±è”½å±æ€§**; è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹æ®Šçš„è¯­æ³•é€ æˆçš„, åªè¦ä½ ç†Ÿæ‚‰è¯­è¨€çš„ç‰¹æ€§, å°±èƒ½çœ‹å‡ºå…¶ä¸­çš„ç«¯å€ª, å¦‚ä¸‹æ‰€ç¤º:

``` javascript
var prototype = {
    count: 1
}

var obj = Object.create(prototype)

// console
> obj
< {
  __proto__: {
    count: 1,
  }
}
```

æˆ‘ä»¬æƒ³ä½¿å¯¹è±¡åŸå‹ä¸­çš„ `count` å±æ€§åŠ ä¸€:

``` javascript
// console
> obj.count++
< 1

> obj
< {
  count: 2,
  __proto__: {
    count: 1,
  }
}
```

å¯¹è±¡ä¸ºè‡ªå·±æ·»åŠ äº†ä¸€ä¸ªè¿ç®—åçš„è‡ªèº«å±æ€§ `count`, åŸå‹é“¾ä¸­çš„ `count` è¢«å±è”½äº†!

> è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ, å› ä¸ºæˆ‘ä»¬åªæƒ³æ”¹å˜åŸå‹é“¾ä¸­çš„ `count`, ä½†ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢?

- `obj.count++` å®é™…ä¸Šæ˜¯ `obj.count = obj.count + 1` çš„ç¼©å†™
- ç”±æ­¤çœ‹å‡º, `count` è¢« ([[PUT]]) èµ‹å€¼äº†
- å¯¹è±¡è‡ªèº«å±æ€§ä¸­æ²¡æœ‰ `count`, ä½†åœ¨åŸå‹é“¾ä¸­æœ‰, æ‰€ä»¥è¿ç”¨äº†è§„åˆ™ `3.1)`, ä¸ºå¯¹è±¡åˆ›å»ºä¸€ä¸ªåŒåçš„è‡ªèº«å±æ€§, å±è”½æ‰€æœ‰åŒååŸå‹é“¾ä¸­çš„å±æ€§

> é‚£ä¹ˆå¦‚ä½•æ—¢æ”¹å˜åŸå‹é“¾å±æ€§, åˆä¸è§¦å‘ `éšå¼å±è”½` å‘¢?

å¯¹è±¡çš„åŸå‹å¯¹è±¡åªæ˜¯ä¸ `prototype` ç›¸å…³è” *(æ¥ä¸‹æ¥ä¼šè®²è§£)*, æ‰€ä»¥æ”¹å˜**æº**å¯¹è±¡å³å¯:

``` javascript
// console:
> prototype.count++
< 1
> obj
< {
  __proto__: {
    count: 2
  },
}
```

## ç±»

### ç±»æ˜¯ä»€ä¹ˆ?

åœ¨é¢å‘ç±»çš„è¯­è¨€ä¸­, ç±»æ˜¯å¯ä»¥è¢«å¤åˆ¶(å®ä¾‹åŒ–)å¤šæ¬¡çš„,

ç±»å°±åƒä¸€å¼  *å·¥ç¨‹è“å›¾*, é‡Œé¢æœ‰å„ç§æ•°æ®è§„æ ¼, æ–½å·¥æ–¹æ³•,

è€Œå®ä¾‹å°±æ˜¯ä½¿ç”¨è¯¥å›¾çº¸åˆ¶ä½œå‡ºæ¥çš„äº§å“, è¯­ä¹‰ä¸Šæ¥ç†è§£, æ¯ä¸€ä¸ªå®ä¾‹éƒ½æ˜¯ç”±è“å›¾æ„é€ å‡ºæ¥çš„ç‹¬ç«‹çš„å®ä½“

### JavaScript çš„"ç±»"

è€Œåœ¨ `JavaScript` ä¸­, å¹¶æ²¡æœ‰ `ç±»` è¿™ä¸ªæ¦‚å¿µ, `JavaScript` åˆ›å»ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯**å¯¹è±¡**, å¯ä»¥è¯´ `JavaScript` ç®—å¾—ä¸Šæ˜¯çœŸæ­£çš„é¢å‘å¯¹è±¡çš„è¯­è¨€äº†.

è™½ç„¶ `JavaScript` æ²¡æœ‰ç±», ä½†é•¿ä¹…ä»¥æ¥æˆ‘ä»¬åˆ©ç”¨å‡½æ•°çš„ä¸€äº›ç‰¹æ®Šç‰¹æ€§, æ¥æ¨¡ä»¿ä¸€äº› "ç±»ä¼¼ç±»" çš„è¡Œä¸º,

æ‰€ä»¥, æœ¬æ¥å¾ˆæ™®é€šçš„å‡½æ•°, å½“è¢«èµ‹äºˆå……å½“"ç±»"çš„é‡ä»»æ—¶, æˆ‘ä»¬ç»™äº†å®ƒä¸€ä¸ªæ–°åå­—-**æ„é€ å‡½æ•°**.

**æ„é€ å‡½æ•°**åœ¨ `JavaScript` ä¸­å……å½“äº†"è“å›¾"çš„è§’è‰², æ¯”å¦‚è¯´å†…ç½®çš„ `Object`, `String` æ„é€ å‡½æ•°, ä¸çŸ¥ç–²å€¦çš„ä¸ºæˆ‘ä»¬åˆ›é€ æ‹¥æœ‰ä¸°å¯Œè¡Œä¸ºçš„*å¯¹è±¡*å’Œ*å­—ç¬¦ä¸²*.

### æ„é€ å‡½æ•°

æˆ‘ä»¬çŸ¥é“, å‡½æ•°æ˜¯å¯¹è±¡çš„ä¸€ä¸ªå­ç±», å‡½æ•°åŒå¯¹è±¡ä¸€æ ·, ä¹Ÿæ‹¥æœ‰ [[[Prototype]]](#prototype) åŸå‹,

å‡½æ•°é»˜è®¤éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªåä¸º `prototype` çš„å…¬æœ‰å¹¶ä¸å¯æšä¸¾çš„å±æ€§:

``` javascript
function fn() {}

// console
> fn.prototype
< {
  constructor: fn(),
  __proto__: {
    constructor: Object(),
    hasOwnProperty: hasOwnProperty(),
    ...
  }
}
```

`new` æ“ä½œç¬¦, æ„å¤–çš„å°†è¿™ä¸ª `prototype` å¯¹è±¡å…³è”(å¼•ç”¨)åˆ°å…¶è¿”å›çš„æ–°å¯¹è±¡çš„åŸå‹ä¸Š, è€Œè¿™ç§è¡Œä¸ºé€šå¸¸è¢«ç§°ä½œ `åŸå‹ç»§æ‰¿`,

ä½†æ˜¯, **ç»§æ‰¿**è¿™ä¸ªè¯, åœ¨è¯­ä¹‰ä¸Šä¼šè§‰å¾—è¿›è¡Œäº†**å¤åˆ¶æ“ä½œ**, è€Œ `JavaScript` åªæ˜¯åœ¨ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´åˆ›å»ºäº†ä¸€ä¸ªå…³è”,

ä½ ä¹Ÿå¯ä»¥è¯´æˆ‘ä»¬é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹ä»…ä»…æ˜¯å¼•ç”¨äº†æ„é€ å‡½æ•°çš„ `prototype`, æ‰€ä»¥ `å§”æ‰˜`(ç¬¬å…­ç« ) è¿™ä¸ªæœ¯è¯­, èƒ½å¤Ÿæ›´å‡†ç¡®çš„æè¿° `JavaScript` ä¸­å¯¹è±¡å…³è”çš„æœºåˆ¶.

``` javascript
function Foo() {}
Foo.prototype.name = 'muzi'
```

æˆ‘ä»¬å°è¯•å°† `Foo` æ„é€ å‡½æ•°å®ä¾‹åŒ–(ä½¿ç”¨ `new` æ“ä½œç¬¦è°ƒç”¨):

``` javascript
var foo = new Foo()

// console
> foo
< Foo {
  __proto__: {
    name: "muzi",
    constructor: Foo(),
    __proto__: {...}
  }
}
```

æ²¡é”™, `new` æ“ä½œç¬¦åªæ˜¯å°† `Foo` æ„é€ å‡½æ•°çš„ `prototype` å…³è”åˆ°äº†æ–°çš„ `foo` å¯¹è±¡çš„åŸå‹ä¸Š, ä»…ä»…æ˜¯å¼•ç”¨, æ²¡æœ‰è¿›è¡Œå¤åˆ¶,

``` javascript
// æˆ‘ä»¬æ”¹å˜ Foo.prototype.name,
// å‘ç° foo.__proto__.name ä¹Ÿæ”¹å˜äº†
Foo.prototype.name = 'yaya'
console.log(foo.name) // yaya

// åä¹‹, æˆ‘ä»¬æ”¹å˜ foo.__proto__.name,
// å‘ç°æºå¯¹è±¡ä¸­çš„å±æ€§ name ä¹Ÿæ”¹å˜äº†
foo.__proto__.name = 'muzi'
console.log(Foo.prototype.name)  // muzi
```

**æ„é€ å‡½æ•°**å¹¶æ²¡æœ‰åƒ**é¢å‘ç±»**çš„è¯­è¨€é‚£æ ·, çœŸæ­£æ„é€ ä»€ä¹ˆ, å®ƒåªæ˜¯è¢« `new` è°ƒç”¨çš„æ™®é€šå‡½æ•°è€Œå·²

### åŸå½¢é™·é˜±

å½“ä½¿ç”¨**æ„é€ å‡½æ•°**åˆ›å»ºä¸€ä¸ªå®ä¾‹å, å®ä¾‹ä¸­ä¼šå­˜åœ¨ä¸€ä¸ª `constructor` å±æ€§, æ­£å¸¸æƒ…å†µä¸‹, è¯¥å±æ€§æŒ‡å‘æ„å»ºè¯¥å¯¹è±¡çš„**æ„é€ å‡½æ•°**:

``` javascript
function Foo() {}
var foo = new Foo()

var str = new String('str')

// console
> foo.constructor === Foo
< true
> str.constructor === String
< true
```

> *å®ä¾‹çš„æ„é€ å™¨*ä¸*æ„é€ å‡½æ•°*æ’ç­‰, é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´å®ä¾‹ä¸æ˜¯ç”±æ„é€ å‡½æ•°**æ„é€ **çš„å‘¢?

çœ‹ä»¥ä¸‹ä»£ç :

``` javascript
function Foo() {}
Foo.prototype = {
    name: 'Foo'
}

var foo = new Foo()

// console
> foo.constructor === Foo
< false
> foo.constructor === Object
< true
```

ä» `foo.constructor === Foo` ä¸º `false` å¯ä»¥çœ‹å‡º, å¦‚æœæˆ‘ä»¬å°†å®ä¾‹çš„ `constructor` ç†è§£ä¸ºè¯¥å®ä¾‹ç”±è°æ„é€ çš„è¯, ç»å¯¹æ˜¯é”™è¯¯çš„:

- `Foo` æ„é€ å‡½æ•°çš„ `prototype` è¢«å®Œå…¨é‡å†™äº†, å–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡

- æˆ‘ä»¬è¯´è¿‡, `var foo = new Foo()` ä»…ä»…æ˜¯å°† `Foo.prototype` å…³è”åˆ°äº† `foo` å¯¹è±¡çš„åŸå‹ä¸Š, æ­¤æ—¶çš„ `Foo.prototype` å¯¹è±¡ä¸­æ ¹æœ¬å°±æ²¡æœ‰ `constructor`

- æ—¢ç„¶æ²¡æœ‰ `foo` å¯¹è±¡ç»§æ‰¿è¿‡æ¥çš„åŸå‹ä¸Šæ²¡æœ‰ `constructor`, æ ¹æ® `[[GET]]` çš„è¡Œä¸ºå‡†åˆ™, `foo.constructor` ä¼šåœ¨åŸå‹é“¾ä¸­ä¸€å±‚ä¸€å±‚çš„æ‰¾è¯¥å±æ€§, æ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†é“¾é¡¶ç«¯çš„ `Object.prototype.constructor`, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ `foo.constructor === Object` çš„åŸå› 

å¾ˆé—æ†¾, åœ¨æ²¡æœ‰æ”¹å†™ `Foo.prototype` ä¹‹å‰,

`foo.constructor === Foo` ä»…ä»…æ˜¯ä¸ªå·§åˆ, æ°å·§åœ¨ `new` æ“ä½œç¬¦å…³è”ä¸¤ä¸ªå¯¹è±¡çš„æ—¶å€™, æŠŠ `Foo` æ„é€ å‡½æ•°çš„ `constructor` ç»™äº† `foo` å®ä¾‹

> å½“ç„¶, æˆ‘ä»¬å¯ä»¥è‡ªå·±åŠ¨æ‰‹ä¸º **æ„é€ å‡½æ•°** æ·»åŠ  `constructor` å±æ€§, æ¥æ¬ºéª—è‡ªå·±-æ„é€ å‡½æ•°ç¡®å®æ˜¯æ„é€ äº†å®ä¾‹ğŸ˜­

``` javascript
function Foo() {}
Object.defineProperty(Foo.prototype, 'constructor', {
    enumerable: false,  // ä¸å¯æšä¸¾
    writable: true,
    configurable: true,
    value: Foo
})

var foo = new Foo()

// console
> foo.constructor === Foo
< true
```

æ€»ç»“:

å®ä¾‹çš„ `constructor` ä»…ä»…æ˜¯ä¸ªä¸å¯æšä¸¾çš„æ™®é€šå±æ€§(ç”šè‡³å¯ä»¥è¢«ç¯¡æ”¹), å®ƒä»¬ä¸ä¸€å®šä¼šæŒ‡å‘çœŸæ­£çš„**å‡½æ•°å¼•ç”¨**, æå…¶ä¸ç¨³å®š, æ‰€ä»¥å®é™…å¼€å‘è¿‡ç¨‹ä¸­è¦å°½é‡é¿å…ä½¿ç”¨å®ƒä»¬.

## åŸå‹ç»§æ‰¿
